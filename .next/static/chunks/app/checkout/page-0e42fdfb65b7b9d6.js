(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{92813:function(e,t,s){Promise.resolve().then(s.bind(s,86010))},86010:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var a=s(57437),l=s(2265),r=s(4810),n=s.n(r),i=s(49147),o=s(15483),c=s.n(o);let d=(e,t,s)=>""!==e.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)&&/^\d{10}$/.test(s),m=(e,t,s,a)=>""!==e.trim()&&""!==t.trim()&&""!==s.trim()&&/^\d{6}$/.test(a);function h(e){let{handleNext:t,handleContactFormData:s}=e,[r,n]=(0,l.useState)(""),[i,o]=(0,l.useState)(""),[c,m]=(0,l.useState)("");return(0,l.useEffect)(()=>{let e=localStorage.getItem("shippingInfo");if(e){let{name:t,email:s,phone:a}=JSON.parse(e);n(t||""),o(s||""),m(a||"")}},[]),(0,a.jsxs)("form",{className:"text-white",onSubmit:e=>{if(e.preventDefault(),!d(r,i,c)){alert("Please fill in all fields correctly.");return}let a=localStorage.getItem("shippingInfo");if(a){let e=JSON.parse(a);(e.name!==r||e.email!==i||e.phone!==c)&&localStorage.setItem("shippingInfo",JSON.stringify({name:r,email:i,phone:c})),s(c),t()}else localStorage.setItem("shippingInfo",JSON.stringify({name:r,email:i,phone:c})),s(c),t()},children:[(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example1",children:"Name"}),(0,a.jsx)("input",{type:"text",id:"form4Example1",className:"form-control",value:r,onChange:e=>n(e.target.value)})]}),(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example2",children:"Email address"}),(0,a.jsx)("input",{type:"email",id:"form4Example2",className:"form-control",value:i,onChange:e=>o(e.target.value)})]}),(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example3",children:"Phone"}),(0,a.jsx)("input",{className:"form-control",id:"form4Example3",type:"tel",value:c,onChange:e=>m(e.target.value)})]}),(0,a.jsx)("button",{type:"submit",className:"theme-btn btn-one",children:(0,a.jsx)("span",{children:"Submit"})})]})}function p(e){let{handleNextShipping:t}=e,[s,r]=(0,l.useState)([]),[n,i]=(0,l.useState)("19"),[o,c]=(0,l.useState)([]),[d,h]=(0,l.useState)(""),[p,u]=(0,l.useState)(""),[x,f]=(0,l.useState)("");return(0,l.useEffect)(()=>{fetch("data/states.json").then(e=>e.json()).then(e=>{r(e.filter(e=>"101"===e.country_id))}).catch(e=>console.error("Error fetching states:",e))},[]),(0,l.useEffect)(()=>{n&&fetch("data/cities.json").then(e=>e.json()).then(e=>{c(e.filter(e=>e.state_id===n))}).catch(e=>console.error("Error fetching cities:",e))},[n]),(0,l.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("shippingInfo"));if(e){var t,s;u(e.address||""),i((null===(t=e.selectedState)||void 0===t?void 0:t.id)||"19"),h((null===(s=e.selectedCity)||void 0===s?void 0:s.id)||""),f(e.postalCode||"")}},[]),(0,l.useEffect)(()=>{if(s.length&&o.length){let e=JSON.parse(localStorage.getItem("shippingInfo"))||{},t=s.find(e=>e.id===n)||"",a=o.find(e=>e.id===d)||"",l={...e,address:p,selectedState:t,selectedCity:a,postalCode:x};localStorage.setItem("shippingInfo",JSON.stringify(l))}},[p,n,d,x,s,o]),(0,a.jsxs)("form",{className:"text-white",onSubmit:e=>{e.preventDefault(),m(p,n,d,x)?t():alert("Please fill in all fields correctly. Postal code must be 6 digits.")},children:[(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example4",children:"Address"}),(0,a.jsx)("input",{type:"text",id:"form4Example4",className:"form-control",value:p,onChange:e=>u(e.target.value)})]}),(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example8",children:"Country"}),(0,a.jsx)("input",{readOnly:!0,value:"India",type:"text",id:"form4Example8",className:"form-control"})]}),(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example6",children:"State"}),(0,a.jsxs)("select",{id:"form4Example6",className:"form-control form-select",value:n,onChange:e=>i(e.target.value),children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Select state"}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example5",children:"City"}),(0,a.jsxs)("select",{id:"form4Example5",className:"form-control",value:d,onChange:e=>h(e.target.value),children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Select city"}),o.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{"data-mdb-input-init":!0,className:"form-outline mb-4",children:[(0,a.jsx)("label",{className:"form-label mb-0",htmlFor:"form4Example7",children:"Postal Code"}),(0,a.jsx)("input",{type:"text",id:"form4Example7",className:"form-control",value:x,onChange:e=>f(e.target.value)})]}),(0,a.jsx)("button",{"data-mdb-ripple-init":!0,type:"submit",className:"theme-btn btn-one",children:(0,a.jsx)("span",{children:"Go to Checkout"})})]})}var u=s(33145);function x(e){let{quantity:t,onQuantityChange:s}=e,[r,n]=(0,l.useState)({fullName:"",phone:"",email:"",address:""});return(0,l.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("shippingInfo"));e&&n(e)},[]),(0,a.jsx)("div",{className:"card mb-3",style:{maxWidth:"600px"},children:(0,a.jsxs)("div",{className:"row no-gutters",children:[(0,a.jsx)("div",{className:"col-md-4",style:{position:"relative",paddingLeft:"20px",paddingTop:"20px"},children:(0,a.jsx)(u.default,{src:"/assets/images/gallery/gallery-1.png",width:100,height:100,alt:"product image",quality:100,className:"card-img pl-5",layout:"responsive"})}),(0,a.jsx)("div",{className:"col-md-8",children:(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsx)("h5",{className:"card-title",children:"Stamen Cream"}),(0,a.jsxs)("div",{style:{fontSize:"0.9em"},className:"card-text text-black",children:[(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[(0,a.jsx)("button",{className:"btn btn-outline-secondary",onClick:()=>{s(Math.max(1,t-1))},children:"-"}),(0,a.jsx)("input",{type:"number",className:"form-control text-center mx-2",style:{width:"100%"},value:t,disabled:!0,onChange:e=>{let t=parseInt(e.target.value,10);!isNaN(t)&&t>0&&s(t)},min:"1"}),(0,a.jsx)("button",{className:"btn btn-outline-secondary",onClick:()=>{s(t+1)},children:"+"})]}),(0,a.jsxs)("div",{className:"d-flex border-bottom w-100",children:[(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("b",{children:"Full Name:"})}),(0,a.jsx)("div",{className:"col-8",children:r.name||"N/A"})]}),(0,a.jsxs)("div",{className:"d-flex border-bottom w-100",children:[(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("b",{children:"Phone:"})}),(0,a.jsx)("div",{className:"col-8",children:r.phone||"N/A"})]}),(0,a.jsxs)("div",{className:"d-flex border-bottom w-100",children:[(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("b",{children:"Email:"})}),(0,a.jsx)("div",{className:"col-8",children:r.email||"N/A"})]}),(0,a.jsxs)("div",{className:"d-flex border-bottom w-100",children:[(0,a.jsx)("div",{className:"col-4",children:(0,a.jsx)("b",{children:"Address:"})}),(0,a.jsx)("div",{className:"col-8",children:r.address||"N/A"})]})]})]})})]})})}var f=s(738),b=s(44752);let v=(0,f.ZF)({apiKey:"AIzaSyCc3djXn7eTpAvJROD5M3_JW3YbC_B23d0",authDomain:"stamen-16efd.firebaseapp.com",projectId:"stamen-16efd",storageBucket:"stamen-16efd.firebasestorage.app",messagingSenderId:"302312052750",appId:"1:302312052750:web:e46a407e3ae4d86e14445f",measurementId:"G-4KPM1C1JMN"}),g=(0,b.v0)(v);var j=s(83464);let N=async e=>{try{return(await j.Z.post("".concat("https://stamen-admin.vercel.app","/api/auth/phone"),e,{withCredentials:!0,headers:{"Content-Type":"application/json"}})).data}catch(e){if(e.response)throw Error(e.response.data.message||"Error registering user");if(e.request)throw Error("No response received from server");throw Error(e.message||"Error setting up request")}},S=async e=>{try{return(await j.Z.post("".concat("https://stamen-admin.vercel.app","/api/orders"),e,{withCredentials:!0,headers:{"Content-Type":"application/json"}})).data.data}catch(e){var t,s;throw console.error("Error creating order:",e),(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to create order"}};var y=s(99376),C=s(5515),I=s.n(C),E=e=>{let{phone:t,name:s,shippingInfo:r,Quantity:n,closeModal:i}=e,[o,c]=(0,l.useState)(t||""),[d,m]=(0,l.useState)(s||""),[h,p]=(0,l.useState)(""),[u,x]=(0,l.useState)(""),[f,v]=(0,l.useState)(0),[j,C]=(0,l.useState)(!1),[E,w]=(0,l.useState)(!1),O=(0,y.useRouter)(),[_,k]=(0,l.useState)("");(0,l.useEffect)(()=>{if(f>0){let e=setInterval(()=>{v(e=>e-1)},1e3);return()=>clearInterval(e)}C(!1)},[f]);let F=()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new b.lI(g,"recaptcha-container",{size:"invisible",callback:e=>{console.log("reCAPTCHA verified")},"expired-callback":()=>{console.log("reCAPTCHA expired")}}))},P=e=>{(e=e.trim()).startsWith("+91")||(e="+91"+e);let t=e.replace("+91","");if(/^\d{10}$/.test(t))return e;throw k("Invalid phone number. It should contain exactly 10 digits"),Error("Invalid phone number. It should contain exactly 10 digits")},T=async e=>{try{var t;let s=P(e);w(!0),F();let a=null===(t=window)||void 0===t?void 0:t.recaptchaVerifier;try{let e=await (0,b.$g)(g,s,a);x(e.verificationId),console.log("OTP sent"),c(s),C(!0),v(60)}catch(e){console.error("Error sending OTP:",e)}finally{w(!1)}}catch(e){console.error(e)}},A=async()=>{w(!0);let e=b.RO.credential(u,h);try{let s=await (0,b.sB)(g,e),a=s.user.accessToken,l=h+"@stamen";if(s.user.accessToken){let e=await N({name:d,phone:o,password:l,accessToken:a});if(console.log("User registered successfully"),e.user.id){var t;let s=(t=e.user.id,{shippingInfo:{fullName:r.name,address:r.address,city:r.selectedCity.name,phoneNo:r.phone,zipCode:r.postalCode,country:"India"},user:t,orderItems:[{name:"Stamen Cream",quantity:n||1,image:"".concat("http://localhost:3000","/assets/images/banner/banner-img-1.png"),price:"500",product:"product_id_here"}],paymentMethod:"COD",paymentInfo:{id:"",status:""},itemsPrice:500,taxAmount:0,shippingAmount:0,totalAmount:500,orderStatus:"Processing"}),a=await S(s);a._id&&(I().fire({title:"Order Success",text:"Your order was successful!",icon:"success",showCancelButton:!0,confirmButtonText:"Order Details",cancelButtonText:"View Orders"}).then(e=>{e.isConfirmed?O.push("/orders/".concat(a._id)):O.push("/orders")}),i())}}}catch(e){console.error("Error:",e.message)}finally{w(!1)}};return(0,a.jsxs)("div",{className:"container mt-2 ",children:[(0,a.jsx)("div",{id:"recaptcha-container"}),(0,a.jsx)("div",{className:"row justify-content-center",children:(0,a.jsxs)("div",{className:"col-md-12",children:[!u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{htmlFor:"phoneNumber",className:"form-label",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",className:"form-control",id:"phoneNumber",value:o,onChange:e=>c(e.target.value),placeholder:"Enter phone number"}),_&&(0,a.jsx)("div",{className:"text-danger",children:_})]}),(0,a.jsx)("div",{className:"d-grid mb-4",children:(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>T(o),disabled:E,children:E?(0,a.jsx)("div",{className:"spinner-border text-light",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden",children:"Loading..."})}):"Send OTP"})})]}),u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{htmlFor:"otp",className:"form-label",children:"OTP"}),(0,a.jsx)("input",{type:"text",className:"form-control",id:"otp",maxLength:6,value:h,onChange:e=>p(e.target.value),placeholder:"Enter OTP"})]}),(0,a.jsx)("div",{className:"d-grid mb-3",children:(0,a.jsx)("button",{className:"btn btn-success",onClick:A,disabled:E,children:E?(0,a.jsx)("div",{className:"spinner-border text-light",role:"status",children:(0,a.jsx)("span",{className:"visually-hidden",children:"Loading..."})}):"Verify OTP"})}),(0,a.jsx)("div",{className:"d-grid",children:(0,a.jsx)("button",{className:"btn btn-tertiary",onClick:()=>T(o),disabled:j||E,children:j?"Resend OTP (".concat(f,")"):"Resend OTP"})})]})]})})]})};let w=(e,t,s)=>{I().fire({title:e,text:t,icon:s,buttons:{confirm:{text:"OK",value:!0,visible:!0,className:"",closeModal:!0}}})};function O(){let[e,t]=(0,l.useState)(1),[s,r]=(0,l.useState)(!1),[o,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)(""),[f,b]=(0,l.useState)(""),[v,g]=(0,l.useState)(null),[j,N]=(0,l.useState)(1),S=e=>{N(e)},y=e=>{if(2===e){let s=localStorage.getItem("shippingInfo");if(s){let a=JSON.parse(s);(null==a?void 0:a.name)&&(null==a?void 0:a.email)&&(null==a?void 0:a.phone)?(g(a),t(e)):(w("Error","Need to submit Contact Details.","error"),t(1))}else w("Error","Need to submit Contact Details.","error"),t(1),console.error("Shipping info is not available in localStorage.")}else if(3===e){let s=localStorage.getItem("shippingInfo");if(s){let a=JSON.parse(s);(null==a?void 0:a.address)&&(null==a?void 0:a.postalCode)&&(null==a?void 0:a.selectedCity)&&(null==a?void 0:a.selectedState)?(g(a),t(e)):(w("Error","Need to submit address","error"),t(2))}else w("Error","Need to submit address","error"),t(2),console.error("Shipping info is not available in localStorage.")}else t(e)},C=()=>{if(3===e){let e=localStorage.getItem("shippingInfo");if(e){let t=JSON.parse(e);g(t),b((null==t?void 0:t.name)||""),r(!0)}else console.error("error")}else y(e+1)},I=e=>{u("+91"+e)};return(0,l.useEffect)(()=>{console.log("ph")},[m]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(i.default,{headerStyle:1,footerStyle:1,children:[(0,a.jsxs)("div",{className:c().stepperWrapper,children:[(0,a.jsxs)("div",{className:c().steps,children:[(0,a.jsxs)("button",{className:"".concat(c().step," ").concat(1===e?c().active:""),onClick:()=>y(1),children:["Step 1: ",(0,a.jsx)("br",{})," Contact Info"]}),(0,a.jsxs)("button",{className:"".concat(c().step," ").concat(2===e?c().active:""),onClick:()=>y(2),children:["Step 2: ",(0,a.jsx)("br",{})," Shipping Info"]}),(0,a.jsxs)("div",{style:{color:"black"},className:"".concat(c().step," ").concat(3===e?c().active:""),onClick:()=>y(3),children:["Step 3: ",(0,a.jsx)("br",{})," Checkout"]})]}),(0,a.jsx)("div",{className:c().formContainer,children:(()=>{switch(e){case 1:return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-white",children:"Contact Information"}),(0,a.jsx)(h,{handleNext:C,handleContactFormData:I})]});case 2:return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-white",children:"Shipping Information"}),(0,a.jsx)(p,{handleNextShipping:C})]});case 3:return(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-white",children:"Check Out Session"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(x,{quantity:j,onQuantityChange:S}),(0,a.jsx)("div",{className:"w-100 d-flex justify-content-start",style:{marginBottom:"15px"},children:(0,a.jsx)("button",{onClick:C,className:"theme-btn btn-one",children:(0,a.jsx)("span",{children:"Pay On Delivery"})})})]})]});default:return null}})()})]}),(0,a.jsx)(n(),{isOpen:s,onRequestClose:()=>r(!1),ariaHideApp:!1,style:{overlay:{backgroundColor:"rgba(0, 0, 0, 0.75)",zIndex:9999999},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"20px",borderRadius:"10px",maxWidth:"500px",overflow:"hidden",width:"100%"}},children:(0,a.jsx)(E,{name:f,phone:m,shippingInfo:v,Quantity:j,closeModal:()=>{r(!1)}})})]})})}},15483:function(e){e.exports={stepperWrapper:"StepperForm_stepperWrapper__gObwR",steps:"StepperForm_steps__ZZ85j",step:"StepperForm_step__iKKhG",active:"StepperForm_active__3kemx",formContainer:"StepperForm_formContainer__7NaiA"}}},function(e){e.O(0,[363,9461,4387,3395,3464,9409,9147,2971,2117,1744],function(){return e(e.s=92813)}),_N_E=e.O()}]);